# ABC104

## D
カテゴリ: 動的計画法

S[:i]で作られる可能性のある文字列の数を q_i とする。
q_i について、以下が成り立つ。

* q_0 = 1
* S[i] = '?' ならば q_i = 3q_i
* S[i] != '?' ならば q_i = q_{i - 1}

ABC数と同様にAB数, A数を定義する。
Sの先頭からi文字目を S[i], Sの先頭からi文字列までの文字列を S[:i] とする。
a_i を S[:i]のA数の和, b_i を S[:i]のAB数の和, c_i を S[:i]のABC数の和とする。
a_i, b_i, c_i について以下が成り立つ。

* i = 0 ならば a_i = b_i = c_i = 0
* S[i] = 'A' ならば
  * a_i = a_{i - 1} + q_{i - 1}
  * b_i = b_{i - 1}
  * c_i = c_{i - 1}
* S[i] = 'B' ならば
  * a_i = a_{i - 1}
  * b_i = b_{i - 1} + a_{i - 1}
  * c_i = c_{i - 1}
* S[i] = 'C' ならば
  * a_i = a_{i - 1}
  * b_i = b_{i - 1}
  * c_i = c_{i - 1} + b_{i - 1}
* S[i] = '?' ならば
  * a_i = 3a_{i - 1} + q_{i - 1}
  * b_i = 3b_{i - 1} + a_{i - 1}
  * c_i = 3c_{i - 1} + b_{i - 1}

解は c_N である。
